# The Toxic Philosopher - 功能总结

## 🎯 项目概述

"The Toxic Philosopher" 是一个AI驱动的哲学辩论平台，用户可以与苏格拉底、尼采、维特根斯坦、康德、弗洛伊德等哲学家进行一对一对话，或观看多位哲学家同台辩论。

本次更新实现了完整的**体验码申请系统**，包括AI截图识别、管理后台、时间验证等功能。

---

## ✨ 核心功能

### 1. 体验码申请系统

#### 用户端功能

**申请流程**：
1. 用户在公众号/社群评论（至少10字）
2. 截图评论内容（包含用户名、评论内容、时间）
3. 在网站上传截图
4. AI自动识别并验证
5. 通过验证后自动生成体验码
6. 体验码保存在浏览器LocalStorage中

**验证规则**：
- ✅ 评论必须≥10字
- ✅ 评论时间必须在2天内
- ✅ 同一评论不能重复使用
- ✅ 同一评论不能被多个用户使用
- ✅ 用户名必须与截图中的用户名匹配

**用户体验**：
- 黑白极简UI设计
- 支持Ctrl+V粘贴截图
- 实时AI解析预览
- 自动保存体验码
- 支持多个体验码

### 2. 管理后台

#### 登录系统
- 路径：`/admin/login`
- 密码保护（配置在.env中）
- Token认证机制

#### 体验码管理
- 查看所有体验码列表
- 查看使用状态（未使用/已使用）
- 手动生成体验码
- 重置体验码（恢复为未使用）
- 调整使用次数
- 重新生成新体验码
- 删除体验码

#### 申请记录管理
- 查看所有申请记录
- 筛选不同状态：
  - **已通过**：申请成功，已生成体验码
  - **已拒绝**：申请失败（评论不足10字、时间过旧等）
  - **待审核**：用户上传截图预览，但未提交申请
  - **已激活**：用户使用体验码激活 ✨
- 查看AI识别结果（用户名、评论内容、置信度）
- 查看上传的截图
- 查看拒绝原因

### 3. AI截图识别

**技术实现**：
- 使用OpenAI Vision API（gpt-4o-mini）
- 通过API2D代理服务（更稳定、更便宜）
- 自动识别截图中的：
  - 用户名（英文ID）
  - 评论内容
  - 评论时间（支持相对时间如"昨天 21:58"）

**识别能力**：
- 支持各种截图格式（微信、企业微信、网页等）
- 自动提取关键信息
- 宽松匹配用户名（大小写不敏感）
- 智能判断是否为评论截图

### 4. 时间解析系统

**支持的时间格式**：
- "昨天 21:58"
- "今天 14:30"
- "前天 10:00"
- "2天前"
- "3小时前"
- "30分钟前"
- "刚刚"
- "11月5日"
- "2024年11月5日"

**时区处理**：
- 所有时间按中国时区（GMT+8）处理
- 自动转换相对时间为绝对时间
- 精确验证评论时间是否在2天内

### 5. 激活记录追踪 ✨

**新功能**：
- 记录用户使用体验码激活的行为
- 区分自主申请和分享激活
- 简洁的数据结构（不包含AI审核信息）
- 在管理后台单独显示

**数据记录**：
```json
{
  "userName": "用户名",
  "status": "activated",
  "appliedAt": "激活时间",
  "code": "使用的体验码"
}
```

---

## 🔒 安全特性

### 防重复机制
- 同一用户不能用同一条评论多次申请
- 同一条评论不能被多个用户使用
- 体验码使用后自动标记为已使用

### 时间验证
- 评论必须在2天内
- 防止使用过期评论申请

### 访问控制
- 管理后台需要密码登录
- Token认证机制
- API接口权限控制

### 数据持久化
- 体验码数据存储在JSON文件
- 申请记录完整保存
- 截图文件本地存储
- 支持数据备份

---

## 📊 数据统计

### 申请记录状态

| 状态 | 说明 | 颜色标识 |
|------|------|----------|
| approved | 已通过 | 绿色 |
| rejected | 已拒绝 | 红色 |
| pending | 待审核 | 黄色 |
| activated | 已激活 | 蓝色 |

### 拒绝原因统计

常见拒绝原因：
- 评论内容不足10字
- 评论时间过旧（超过2天）
- 该评论已被其他用户使用
- 该评论已用于申请体验码
- 用户名不匹配
- AI识别失败

---

## 🎨 UI设计

### 设计风格
- 黑白极简风格
- 无彩色元素
- 清晰的层次结构
- 响应式设计

### 主要页面

1. **主页**
   - 哲学家介绍
   - 模式选择（一对一/思想角斗场）
   - 体验码入口

2. **体验码申请页面**
   - 截图上传（支持拖拽和粘贴）
   - AI实时解析预览
   - 申请结果提示

3. **管理后台**
   - 体验码列表
   - 申请记录列表
   - 手动生成体验码
   - 截图查看器

---

## 🔧 技术栈

### 前端
- React 18
- TypeScript
- Vite
- TailwindCSS
- React Router

### 后端
- Node.js
- Express
- TypeScript
- Multer（文件上传）
- OpenAI API

### AI服务
- OpenAI Vision API
- API2D代理服务
- gpt-4o-mini模型

### 数据存储
- JSON文件存储
- LocalStorage（前端）
- 文件系统（截图）

---

## 📈 使用流程

### 用户申请流程

```
1. 用户在公众号/社群评论
   ↓
2. 截图评论（包含用户名、内容、时间）
   ↓
3. 访问网站，上传截图
   ↓
4. AI自动识别并验证
   ↓
5. 通过验证，生成体验码
   ↓
6. 体验码自动保存，可直接使用
```

### 管理员管理流程

```
1. 登录管理后台
   ↓
2. 查看申请记录
   ↓
3. 查看截图和AI识别结果
   ↓
4. 管理体验码（重置、调整、删除）
   ↓
5. 手动生成体验码（可选）
```

---

## 🌟 亮点功能

### 1. AI自动化审核
- 无需人工审核
- 秒级响应
- 准确率高

### 2. 多体验码支持
- 用户可以用不同评论申请多个体验码
- 每个体验码独立使用
- 自动管理使用状态

### 3. 完整的记录追踪
- 记录所有申请尝试
- 包括成功和失败的申请
- 记录激活行为
- 可查看历史截图

### 4. 灵活的时间解析
- 支持多种时间格式
- 自动处理时区
- 精确到分钟的验证

### 5. 简洁的管理后台
- 一目了然的数据展示
- 强大的筛选功能
- 便捷的操作按钮
- 实时数据更新

---

## 📱 支持的场景

### 评论来源
- 微信公众号评论
- 企业微信群聊
- 朋友圈评论
- 其他社交平台

### 截图格式
- JPG / JPEG
- PNG
- GIF
- WEBP

### 设备支持
- 桌面浏览器
- 移动浏览器
- 平板设备

---

## 🔮 未来扩展

### 可能的功能增强

1. **邮件通知**
   - 申请成功后发送邮件
   - 体验码即将过期提醒

2. **数据分析**
   - 申请成功率统计
   - 用户来源分析
   - 时间分布分析

3. **批量操作**
   - 批量生成体验码
   - 批量导出数据

4. **高级筛选**
   - 按时间范围筛选
   - 按用户名搜索
   - 按拒绝原因筛选

5. **数据库支持**
   - 迁移到PostgreSQL/MySQL
   - 提升性能和可靠性

---

## 📝 配置说明

### 必需配置

```bash
# OpenAI API（AI识别）
OPENAI_API_KEY=your_api_key
OPENAI_BASE_URL=https://oa.api2d.net
OPENAI_MODEL=gpt-4o-mini

# 管理员密码
ADMIN_PASSWORD=your_password

# 服务器配置
BASE_URL=http://localhost:3000
PORT=3000
```

### 可选配置

- 文件上传大小限制
- 时间验证天数（默认2天）
- 评论最小字数（默认10字）
- API请求超时时间

---

## 🎓 学习价值

本项目展示了以下技术实践：

1. **AI集成**
   - Vision API使用
   - 图像识别应用
   - Prompt工程

2. **全栈开发**
   - React前端
   - Express后端
   - TypeScript全栈

3. **文件处理**
   - 图片上传
   - 文件存储
   - 多媒体处理

4. **状态管理**
   - LocalStorage持久化
   - Token认证
   - 数据同步

5. **用户体验**
   - 实时反馈
   - 错误处理
   - 响应式设计

---

## 🏆 项目成果

### 已实现功能统计

- ✅ 10+ 个API接口
- ✅ 8个前端页面
- ✅ 4种申请状态
- ✅ 9种时间格式支持
- ✅ 5个管理功能
- ✅ 完整的错误处理
- ✅ 详细的日志记录
- ✅ 安全的认证机制

### 代码统计

- 75个文件修改/新增
- 9945行代码新增
- 完整的TypeScript类型定义
- 详细的代码注释

---

## 📞 联系方式

- GitHub: https://github.com/danna1013/the-toxic-philosopher
- 分支: feature/access-code-system

---

**祝您部署顺利！🎉**
